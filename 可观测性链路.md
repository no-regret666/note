# 可观测性链路

### Filebeat（采集层）

- 作用：轻量级日志采集器
- 职责：从本地日志文件、容器日志、系统日志等收集数据，打包发送给kafka，logstash或直接elasticsearch
- 定位：Agent/边车，运行在应用服务器或容器旁边
- 用途：收集Nginx，应用服务日志，然后转发



### Kafka（传输层/缓冲层）

- 作用：高吞吐、分布式的消息队列
- 职责：作为日志/指标/追踪数据的缓冲区和总线，防止后端存储或处理服务因突发流量被打垮
- 定位：数据总线/缓冲池
- 用途：Filebeat将数据写入Kafka->Logstash或其他消费者再从Kafka拉取处理



### Logstash（处理层）

- 作用：数据处理和ETL（Extract-Transform-Load）
- 职责：对日志进行过滤、解析、格式化（如JSON解析、Grok正则匹配、脱敏），再输出到Elasticsearch、Kafka或数据库
- 定位：可编程数据处理管道
- 用途：统一格式化不同服务的日志，丰富字段（如加入主机名、IP），再写入ES



### Elasticsearch（存储&查询层）

- 作用：分布式搜索和分析引擎
- 职责：存储日志、指标和追踪数据，支持快速搜索、聚合分析
- 定位：存储&分析核心
- 用途：存储所有服务日志，提供搜索接口给Kibana或Jaeger



### Jaeger（分布式追踪层）

- 作用：分布式追踪系统
- 职责：收集、存储和展示服务调用链路数据
- 定位：Tracing部分，专注于链路级别的可观测性
- 典型用途：排查请求延迟在哪个服务、哪一条SQL，哪个远程调用



### 优点

1. 统一采集和集中化管理
   - 各个应用、容器、节点的日志、指标、追踪数据统一采集。
   - 不需要到处ssh登服务器翻日志。
2. 高可用&防止数据丢失
   - Kafka作为缓冲层，可以抵御突发流量
   - 即使后端ES、LogStash挂了，数据也不会直接丢失
   - 增强系统健壮性，容灾能力更强
3. 灵活拓展&高性能
   - 每个环节可以独立水平扩展：
     - 日志量大时->扩Kafka集群
     - 处理逻辑复杂：多加LogStash节点
     - 查询多：扩Elasticsearch节点
4. 数据清洗与标准化
   - Logstash / go-stash 等可以把不同格式的日志（Nginx、Java、容器）解析成统一 JSON 格式。
   - 可以做字段提取、脱敏（比如隐藏手机号/密码）、增加上下文（IP、主机名）。
   - 好处：后续搜索、聚合更高效，安全合规。
5. 支持多维度分析
   - 日志（Logs）：定位报错、异常。
   - 指标（Metrics）：监控系统性能、资源利用。
   - 追踪（Traces）：分析请求在哪一层慢、排查分布式调用瓶颈。
   - 好处：三合一（Logs + Metrics + Traces），全面了解系统运行状态。